Hereâ€™s the content for **Page 6: Creating and Using the Python Script for Image Capture and Transmission**:

---

## **Creating and Using the Python Script for Image Capture and Transmission**

The following steps will guide you through creating and running a Python script to capture images using the Raspberry Pi HQ Camera and send them to the laptop over MQTT.

---

### **1. Creating the Python Script**

1. Open a terminal on the Raspberry Pi.
2. Navigate to your preferred working directory:
   ```bash
   cd ~
   ```
3. Create a new Python file named `image_sender.py`:
   ```bash
   nano image_sender.py
   ```

4. Copy and paste the following script into the file:

```python
import paho.mqtt.client as mqtt
import cv2
import time
from datetime import datetime
import os
import numpy as np

# MQTT Broker Details
BROKER_ADDRESS = "192.168.66.132"  # Replace with your laptop's IP
TOPIC = "camera/images"

# Function to publish an image to MQTT
def send_image(client, topic, image):
    # Resize the image for compatibility
    resized_image = cv2.resize(image, (480, 360))  # Resize to (width, height)
    
    # Encode the image as JPEG
    _, buffer = cv2.imencode('.jpg', resized_image)
    client.publish(topic, buffer.tobytes())
    print(f"Image sent at {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

# Main function
def main():
    client = mqtt.Client()
    client.connect(BROKER_ADDRESS, 1883, 60)

    print("Starting camera stream...")
    cap = cv2.VideoCapture(0)  # Default camera stream

    if not cap.isOpened():
        print("Error: Could not open camera stream.")
        return

    try:
        while True:
            ret, frame = cap.read()
            if not ret:
                print("Error: Could not read frame.")
                break

            # Send the captured frame
            send_image(client, TOPIC, frame)

            # Wait for 2 seconds before capturing the next frame
            time.sleep(2)

    except KeyboardInterrupt:
        print("Stream stopped by user.")
    finally:
        cap.release()
        print("Camera stream stopped.")

if __name__ == "__main__":
    main()
```

---

### **2. Installing Required Libraries**

Ensure that the following Python libraries are installed on the Raspberry Pi:

- **`paho-mqtt`**: For MQTT communication.
- **`opencv-python-headless`**: For capturing and resizing images.
- **`numpy`**: For image processing.

You can install them using:
```bash
pip3 install paho-mqtt opencv-python-headless numpy
```

---

### **3. Running the Python Script**

1. Ensure the MQTT broker on the laptop is running:
   ```bash
   sudo systemctl start mosquitto
   ```

2. Run the Python script on the Raspberry Pi:
   ```bash
   python3 image_sender.py
   ```

3. Check the logs:
   - The script will log messages like:
     ```
     Image sent at 2023-12-28 15:30:45
     ```

---

### **4. Verifying Image Transmission**

On the laptop:
1. Subscribe to the MQTT topic to verify image transmission:
   ```bash
   mosquitto_sub -h localhost -t camera/images > received_image.jpg
   ```
2. Open the received image:
   ```bash
   xdg-open received_image.jpg
   ```

---

### **5. Automating the Script on Boot**

To run the script automatically when the Raspberry Pi boots:
1. Open the crontab editor:
   ```bash
   crontab -e
   ```
2. Add the following line at the end of the file:
   ```bash
   @reboot python3 /home/pi/image_sender.py
   ```
3. Save and exit. The script will now start automatically after a reboot.

---

By following these steps, your Raspberry Pi will continuously capture and transmit images to the laptop, enabling seamless integration with your data collection system.

Let me know if youâ€™d like to add more details or move on to the next section! ðŸš€
